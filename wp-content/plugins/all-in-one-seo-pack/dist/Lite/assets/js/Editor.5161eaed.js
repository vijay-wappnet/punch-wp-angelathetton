import{J as Q,aC as A,d as j,aq as z,u as Z}from"./app-core.61d75c0b.js";import{Q as l}from"./vendor-quill.d8afd3e5.js";import{h as B,_ as S}from"./vendor-other.2cdd5822.js";import{B as K}from"./Input.74b8f197.js";import{S as J}from"./Caret.c4a084e6.js";import{_ as R}from"./_plugin-vue_export-helper.eefbdd86.js";import{f as C,i as b,j as p,as as I,P as X,M as y,B as O,O as V,ad as Y,Y as E,a5 as v,U as M,a0 as N}from"./vendor-vue-ui.d70c869f.js";import{_ as G}from"./Trash.effd183e.js";const tt=(n,t,e)=>{const s=n;return Object.keys(t).forEach(i=>{-1<e.indexOf(i)?s.dataset[i]=t[i]:delete s.dataset[i]}),s},D=(n,t)=>t.reduce((e,s)=>{const i=n.lastIndexOf(s);return i>e.mentionCharIndex?{mentionChar:s,mentionCharIndex:i}:{mentionChar:e.mentionChar,mentionCharIndex:e.mentionCharIndex}},{mentionChar:null,mentionCharIndex:-1}),et=(n,t)=>t.test(n),st=(n,t,e)=>-1<n?!(e&&!(n===0||t[n-1].match(/\s/g))):!1,it=l.import("blots/embed");class T extends it{constructor(t,e){super(t,e),this.clickHandler=this.clickHandler.bind(this),e.addEventListener("click",this.clickHandler)}static getQuillInstance(t){let e=l.find(t);if(e){for(;e.parent;)e=e.parent;return e.domNode.parentNode?l.find(e.domNode.parentNode):null}}clickHandler(){const t=T.getQuillInstance(this.domNode),e=t.getModule("mention");if(e.currentBlot=this,e.currentNode=this.domNode,e.isOpen)return this.domNode.querySelector(".aioseo-tag .tag-toggle svg").classList.remove("rotated"),e.hideMentionList();this.domNode.querySelector(".aioseo-tag .tag-toggle svg").classList.add("rotated"),e.mentionCharPos=this.offset(t.scroll),e.options.source("",e.renderList.bind(e,this.domNode.dataset.denotationChar),this.domNode.dataset.denotationChar)}static create(t){const e=super.create(),s=document.createElement("span");if(s.className="ql-mention-denotation-char",s.innerHTML=t.denotationChar||"#",e.appendChild(s),e.innerHTML+=t.value,t.custom&&t.customValue){let i=e.querySelector(".tag-custom");if(!i){i=document.createElement("span"),i.classList.add("tag-custom");const a=e.querySelector(".tag-name");a.parentNode.insertBefore(i,a.nextSibling)}i.innerHTML="&nbsp;-&nbsp;"+(t.customValue||"")}return setTimeout(()=>{const i=T.getQuillInstance(e);if(i){const a=i.getModule("mention");a.currentNode=e}},0),T.setDataValues(e,t)}static setDataValues(t,e){const s=t;return Object.keys(e).forEach(i=>{s.dataset[i]=e[i]}),s}static value(t){return t.dataset}format(t,e){t==="customValue"&&e?this.domNode.dataset.customValue=e:super.format(t,e)}}T.blotName="mention";T.tagName="span";T.className="mention";l.register(T);const m={TAB:"Tab",ENTER:"Enter",ESCAPE:"Escape",UP:"ArrowUp",DOWN:"ArrowDown",SPACE:" "};class nt{constructor(t,e){this.isOpen=!1,this.itemIndex=0,this.mentionCharPos=null,this.cursorPos=null,this.values=[],this.suspendMouseEnter=!1,this.activeElement=null,this.currentBlot=null,this.currentNode=null,this.quill=t,this.silentInsert=!1,this.insertingCustomItem=!1,this.options={source:null,renderItem(r){return`${r.value}`},onSelect(r,h){h(r)},mentionDenotationChars:["@"],showDenotationChar:!0,allowedChars:/^[a-zA-Z0-9_]*$/,minChars:0,maxChars:1e3,offsetTop:2,offsetLeft:0,isolateCharacter:!1,fixMentionsToQuill:!1,defaultMenuOrientation:"bottom",dataAttributes:["id","value","denotationChar","link","target"],linkTarget:"_blank",onOpen(){return!0},onClose(){return!0},listItemClass:"ql-mention-list-item",mentionContainerClass:"ql-mention-list-container",mentionListClass:"ql-mention-list",spaceAfterInsert:!0,selectKeys:[m.ENTER]},Object.assign(this.options,e,{dataAttributes:Array.isArray(e.dataAttributes)?this.options.dataAttributes.concat(e.dataAttributes):this.options.dataAttributes}),this.mentionContainer=document.createElement("div"),this.mentionContainer.className=this.options.mentionContainerClass?this.options.mentionContainerClass:"",this.mentionContainer.style.cssText="display: none; position: absolute;",this.mentionContainer.onmousemove=this.onContainerMouseMove.bind(this),this.options.fixMentionsToQuill&&(this.mentionContainer.style.width="auto"),this.customFieldInput=document.createElement("div"),this.customFieldInput.className=this.options.mentionPrependClassCustom?this.options.mentionPrependClassCustom:"",this.customFieldInput.innerHTML=this.options.customFieldInput||"",this.mentionContainer.appendChild(this.customFieldInput),this.mentionSearch=document.createElement("div"),this.mentionSearch.className=this.options.mentionPrependClass?this.options.mentionPrependClass:"",this.mentionSearch.innerHTML=this.options.prependMentionList||"",this.mentionContainer.appendChild(this.mentionSearch);const s=this.mentionSearch.querySelector(".aioseo-trash");s&&s.addEventListener("click",()=>{this.currentBlot.remove(),this.hideMentionList(),this.removeOrphanedMentionChar()}),this.customFieldInput.addEventListener("click",r=>{this.activeElement=r.target;const h=r.target.querySelector("input");h&&setTimeout(()=>{h.focus()},0)});const i=this.customFieldInput.querySelector("input");i&&i.addEventListener("input",r=>{if(this.currentNode){let h=this.currentNode.querySelector(".tag-custom");if(!h){h=document.createElement("span"),h.classList.add("tag-custom");const u=this.currentNode.querySelector(".tag-name");u.parentNode.insertBefore(h,u.nextSibling)}h.innerHTML=r.target.value?"&nbsp;-&nbsp;"+r.target.value:"",this.currentBlot=l.find(this.currentNode),this.currentBlot.format("customValue",r.target.value)}}),this.customFieldInput.addEventListener("keydown",r=>{m.ENTER===r.key&&(this.hideMentionList(),this.removeOrphanedMentionChar(),r.preventDefault()),m.ESCAPE===r.key&&(this.hideMentionList(),this.removeOrphanedMentionChar()),m.SPACE===r.key&&r.preventDefault()}),this.mentionSearch.addEventListener("click",r=>{this.activeElement=r.target}),this.mentionSearch.addEventListener("keydown",r=>{m.DOWN===r.key&&this.nextItem(),m.UP===r.key&&this.prevItem(),m.ENTER===r.key&&(this.selectItem(),r.preventDefault()),m.ESCAPE===r.key&&this.hideMentionList()});const a=this.mentionSearch.querySelector("input");a&&a.addEventListener("input",r=>{const h=this.getTextBeforeCursor(),{mentionChar:u}=D(h,this.options.mentionDenotationChars);if(!u&&!this.currentBlot)return;const d=u||this.currentBlot.domNode.dataset.denotationChar;this.options.source(r.target.value,this.renderList.bind(this,d),d)}),this.mentionList=document.createElement("ul"),this.mentionList.id="quill-mention-list",t.root.setAttribute("aria-owns","quill-mention-list"),this.mentionList.className=this.options.mentionListClass?this.options.mentionListClass:"",this.mentionContainer.appendChild(this.mentionList);const o=document.createElement("div");o.className="aioseo-documentation-link",o.innerHTML=this.options.documentationDiv||"",o.addEventListener("click",r=>{this.activeElement=r.target}),this.mentionContainer.appendChild(o),this.quill.container.appendChild(this.mentionContainer),t.on("text-change",this.onTextChange.bind(this)),t.on("selection-change",this.onSelectionChange.bind(this)),t.container.addEventListener("paste",()=>{setTimeout(()=>{const r=t.getSelection();this.onSelectionChange(r)})}),t.keyboard.addBinding({key:m.TAB},this.selectHandler.bind(this)),t.keyboard.bindings[m.TAB].unshift(t.keyboard.bindings[m.TAB].pop());for(const r of this.options.selectKeys??[])t.keyboard.addBinding({key:r},this.selectHandler.bind(this));t.keyboard.bindings[m.ENTER].unshift(t.keyboard.bindings[m.ENTER].pop()),t.keyboard.addBinding({key:m.ESCAPE},this.escapeHandler.bind(this)),t.keyboard.addBinding({key:m.UP},this.upHandler.bind(this)),t.keyboard.addBinding({key:m.DOWN},this.downHandler.bind(this)),t.clipboard.addMatcher(Node.TEXT_NODE,this.clipboardHandler.bind(this))}selectHandler(){return this.isOpen?(this.selectItem(),!1):!0}escapeHandler(){return this.isOpen?(this.hideMentionList(),this.removeOrphanedMentionChar(),!1):!0}removeOrphanedMentionChar(t=!1){let e=!1;!t&&!this.quill.hasFocus()&&(this.quill.focus(),e=!0);const s=this.getTextBeforeCursor();s.charAt(s.length-1)==="#"&&this.quill.deleteText(this.quill.getSelection().index-1,1,l.sources.USER),e&&this.quill.blur()}upHandler(){return this.isOpen?(this.prevItem(),!1):!0}downHandler(){return this.isOpen?(this.nextItem(),!1):!0}clipboardHandler(t,e){if(typeof t.data!="string")return;const s=new RegExp(`${this.options.mentionDenotationChars.join("|")}[A-Za-z0-9_-]+`,"g"),i=t.data.match(s);if(i&&0<i.length){const a=[];let o=t.data;this.mentionCharPos=0,i.forEach(r=>{const h=r.charAt(0),u=r.substr(1).split("-"),d=u[0];delete u[0];const f=u.filter(W=>W).join("-"),g=this.options.source(d,this.renderList.bind(this,h),h,!0,f||null);if(!g)return;const L={denotationChar:this.options.showDenotationChar?h:"",...g};f!==void 0&&(L.customValue=f);const x=o.split(r),P=x.shift();a.push({insert:P}),a.push({insert:{mention:L}}),o=x.join(r)}),a.push({insert:o}),e.ops=a}return e}showMentionList(){if(this.mentionContainer.style.visibility="hidden",this.mentionContainer.style.display="",this.setMentionContainerPosition(),this.customFieldInput.style.display="none",this.currentNode&&this.currentNode.dataset.custom){this.customFieldInput.style.display="block";const e=this.customFieldInput&&this.customFieldInput.querySelector("input"),s=this.currentNode.querySelector(".tag-custom");e&&s&&(e.value=s.innerHTML.replace("&nbsp;-&nbsp;","").trim())}const t=this.mentionSearch.querySelector(".aioseo-trash");t&&(t.style.display="block",this.currentBlot||(t.style.display="none")),this.setIsOpen(!0)}hideMentionList(){document.querySelectorAll(".aioseo-tag .tag-toggle svg").forEach(i=>{i.classList.remove("rotated")});const e=this.mentionSearch&&this.mentionSearch.querySelector("input");e&&(e.value="");const s=this.customFieldInput&&this.customFieldInput.querySelector("input");s&&(s.value=""),this.currentBlot=null,this.currentNode=null,this.mentionContainer.style.display="none",this.setIsOpen(!1)}highlightItem(t=!0){if(!this.mentionList.childNodes[this.itemIndex])return;for(let s=0;s<this.mentionList.childNodes.length;s+=1){const i=this.mentionList.childNodes[s];i instanceof HTMLElement&&i.classList.remove("selected")}const e=this.mentionList.childNodes[this.itemIndex];if(!(this.itemIndex===-1||e.dataset.disabled==="true")&&(e.classList.add("selected"),this.quill.root.setAttribute("aria-activedescendant",e.id),t)){const s=e.offsetHeight,i=e.offsetTop-this.mentionSearch.offsetHeight,a=this.mentionList.scrollTop,o=a+this.mentionList.offsetHeight;i<a?this.mentionList.scrollTop=i:i>o-s&&(this.mentionList.scrollTop+=i-o+s)}}getItemData(){const{link:t}=this.mentionList.childNodes[this.itemIndex].dataset,e=typeof t<"u",s=this.mentionList.childNodes[this.itemIndex].dataset.target;return e&&(this.mentionList.childNodes[this.itemIndex].dataset.value=`<a href="${t}" target=${s||this.options.linkTarget}>${this.mentionList.childNodes[this.itemIndex].dataset.value}`),this.mentionList.childNodes[this.itemIndex].dataset}onContainerMouseMove(){this.suspendMouseEnter=!1}selectItem(){const t=this.getItemData();if(!t.id)return this.hideMentionList();this.options.onSelect(t,e=>{this.insertItem(e)}),t.custom||this.hideMentionList()}insertItem(t){const e=t;if(e===null)return;this.options.showDenotationChar||(e.denotationChar=""),t.custom&&(this.insertingCustomItem=!0,setTimeout(()=>{this.insertingCustomItem=!1},50),this.customFieldInput.style.display="block",this.customFieldInput.click());const s=this.mentionCharPos;this.quill.deleteText(this.mentionCharPos,this.cursorPos-this.mentionCharPos,l.sources.USER),this.quill.insertEmbed(s,"mention",e,l.sources.USER),this.options.spaceAfterInsert?(this.quill.insertText(s+1," ",l.sources.USER),this.quill.setSelection(s+2,l.sources.USER)):this.quill.setSelection(s+1,l.sources.USER),t.custom||this.hideMentionList()}onItemMouseEnter(t){if(this.suspendMouseEnter)return;const e=Number(t.target.dataset.index);!Number.isNaN(e)&&e!==this.itemIndex&&(this.itemIndex=e,this.highlightItem(!1))}onItemClick(t){t.preventDefault(),t.stopImmediatePropagation(),this.itemIndex=t.currentTarget.dataset.index,this.highlightItem(),this.selectItem()}renderList(t,e,s,i=!1,a=!1){if(this.mentionList.innerHTML="",e&&0<e.length){if(this.values=e,this.values.length===1&&(this.values[0].name===s||this.values[0].id===s)){if(i)return this.values[0];this.insertItem(this.values[0]);return}else if(i){const o=this.values.find(r=>r.name===s||r.id===s);if(o)return o}else if(a){const o=this.values.find(r=>r.name===s||r.id===s);o&&this.insertItem(o)}for(let o=0;o<e.length;o+=1){const r=document.createElement("li");r.className=this.options.listItemClass?this.options.listItemClass:"",r.dataset.index=o,r.innerHTML=this.options.renderItem(e[o],s),r.onmouseenter=this.onItemMouseEnter.bind(this),r.dataset.denotationChar=t,r.onclick=this.onItemClick.bind(this),this.mentionList.appendChild(tt(r,e[o],this.options.dataAttributes))}this.itemIndex=0,this.highlightItem()}else{const o=document.createElement("li");o.className=this.options.listItemClassNoMatch?this.options.listItemClassNoMatch:"",o.innerHTML=this.options.renderItemNoMatch(),this.mentionList.appendChild(o)}this.showMentionList()}nextItem(){this.itemIndex=(this.itemIndex+1)%this.values.length,this.suspendMouseEnter=!0,this.highlightItem()}prevItem(){this.itemIndex=(this.itemIndex+this.values.length-1)%this.values.length,this.suspendMouseEnter=!0,this.highlightItem()}containerBottomIsNotVisible(){return this.mentionContainer.getBoundingClientRect().bottom>window.innerHeight}containerRightIsNotVisible(t,e){return this.options.fixMentionsToQuill?!1:e.width<t+this.mentionContainer.offsetWidth}setIsOpen(t){this.isOpen!==t&&(t?this.options.onOpen():this.options.onClose(),this.isOpen=t)}setMentionContainerPosition(){const t=this.quill.container.getBoundingClientRect(),e=this.quill.getBounds(this.mentionCharPos),s=this.mentionContainer.offsetHeight;let i=this.options.offsetTop,a=this.options.offsetLeft;if(this.options.fixMentionsToQuill?this.mentionContainer.style.right="0px":a+=e.left,this.containerRightIsNotVisible(a,t)){const o=this.mentionContainer.offsetWidth+this.options.offsetLeft;a=t.width-o}if(this.options.defaultMenuOrientation==="top"){if(this.options.fixMentionsToQuill?i=-1*(s+this.options.offsetTop):i=e.top-(s+this.options.offsetTop),0>=i+t.top){let o=this.options.offsetTop;this.options.fixMentionsToQuill?o+=t.height:o+=e.bottom,i=o}}else if(this.options.fixMentionsToQuill?i+=t.height:i+=e.bottom,this.containerBottomIsNotVisible(i,t)){let o=this.options.offsetTop*-1;this.options.fixMentionsToQuill||(o+=e.top),i=o-s}0<=i?this.options.mentionContainerClass.split(" ").forEach(o=>{this.mentionContainer.classList.add(`${o}-bottom`),this.mentionContainer.classList.remove(`${o}-top`)}):this.options.mentionContainerClass.split(" ").forEach(o=>{this.mentionContainer.classList.add(`${o}-top`),this.mentionContainer.classList.remove(`${o}-bottom`)}),this.mentionContainer.style.top=`${i}px`,this.mentionContainer.style.left=`${a}px`,this.mentionContainer.style.visibility="visible"}getTextBeforeCursor(){const t=Math.max(0,(this.cursorPos??0)-this.options.maxChars);return this.quill.getText(t,(this.cursorPos??0)-t)}onSomethingChange(){const t=this.quill.getSelection();if(t===null||this.insertingCustomItem)return;this.cursorPos=t.index;const e=this.getTextBeforeCursor(),{mentionChar:s,mentionCharIndex:i}=D(e,this.options.mentionDenotationChars);if(st(i,e,this.options.isolateCharacter)){const a=this.cursorPos-(e.length-i);this.mentionCharPos=a;const o=e.substring(i+s.length);o.length>=this.options.minChars&&et(o,this.options.allowedChars)?this.options.source(o,this.renderList.bind(this,s),s):this.hideMentionList()}else this.hideMentionList()}onTextChange(t,e,s){s==="user"&&setTimeout(this.onSomethingChange.bind(this),0)}onSelectionChange(t){t&&t.length===0?this.onSomethingChange():setTimeout(()=>{this.activeElement?this.activeElement.classList.contains("aioseo-tag-custom")||(this.activeElement=null):this.hideMentionList.bind(this)},0)}}l.register("modules/mention",nt);const ot=l.import("modules/toolbar");class F extends ot{}F.DEFAULTS.handlers.autoLink=function(){const n=this.quill.getSelection(),t=this.quill.getModule("autoLink"),e=this.quill.getContents();e.ops.forEach(s=>{s?.attributes?.link&&delete s.attributes.link}),this.quill.setContents(e,l.sources.SILENT),this.quill.setSelection(n,l.sources.SILENT),this.quill.format("link",t.options.url,l.sources.USER)};l.register("modules/toolbar",F,!0);class rt{constructor(t,e){this.quill=t,this.options=e,this.container=document.querySelector(e.container)}}l.register("modules/autoLink",rt,!0);class at{constructor(t,e){this.quill=t,this.options=e,this.container=document.querySelector(e.container),t.on("text-change",this.update.bind(this)),this.update()}calculate(){let t=this.quill.getText()?this.quill.root.innerHTML:"";const e=document.createRange().createContextualFragment(t),s=document.createRange().createContextualFragment("");e.childNodes.forEach(a=>{if(a.tagName!=="P")return;a.childNodes.forEach(r=>{if(r.nodeType===3){s.appendChild(r.cloneNode(!0));return}if(r.tagName==="SPAN"){const h=r.querySelector(".aioseo-tag .tag-name");if(h){const u=this.options.tags.find(g=>g.name===h.textContent);let d=typeof u.valueText=="string"?B.decode(u.valueText):u.valueText;d=Q(d,!1);const f=document.createTextNode(d);s.appendChild(f)}}});const o=document.createElement("br");s.appendChild(o)}),s.normalize();const i=document.createElement("div");return i.appendChild(s.cloneNode(!0)),t=i.innerHTML.replace(/&nbsp;/gi," ").replace(/<br\s*[/]?>/gi,this.single?"":`
`).trim(),{length:B.decode(t).length,text:t}}update(){const{length:t}=this.calculate();let e=this.options.unit;t!==1&&(e+="s"),this.container&&(this.container.innerText=t+" "+e)}}l.register("modules/counter",at);const lt=l.import("modules/clipboard"),ct=l.import("delta");class ht extends lt{onPaste(t,{html:e,text:s}){const i=this.options,a=this.quill.getFormat(t.index),o=this.convert({text:s,html:e},a),r=new ct().retain(t.index).delete(t.length).concat(o);i.newLines===!1&&r.ops.map(function(h){return typeof h.insert=="string"&&(h.insert=h.insert.replace(/(\r\n|\n|\r)/gm," ")),h}),this.quill.updateContents(r,l.sources.USER),this.quill.setSelection(r.length()-t.length,l.sources.SILENT),this.quill.scrollSelectionIntoView()}convert({html:t,text:e}){return typeof t=="string"&&(t=t.replace(/>\r?\n +</g,"><")),super.convert({html:t,text:e})}}l.register("modules/clipboard",ht,!0);class ut{constructor(t,e){this.quill=t,this.options={defaultLength:1,...e},this.container=e.container,t.on("text-change",this.update.bind(this)),this.update()}update(){for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild);const t=this.quill.getLines();if(this.options.defaultLength>t.length)for(let i=t.length;this.options.defaultLength>i;i++)t.push({});let e=0;for(let i=0;i<t.length;i++){const a=t[i].domNode?t[i].domNode.offsetHeight:25,o=document.createElement("div");o.style.minHeight=`${a}px`,o.innerHTML=i+1,this.container.appendChild(o),e+=a}const s=this.quill.container.querySelector(".ql-editor");if(s){const i=window.getComputedStyle(s);s.style.minHeight=`${e+parseInt(i.getPropertyValue("padding-top"))+parseInt(i.getPropertyValue("padding-bottom"))}px`}}}l.register("modules/lineNumbers",ut,!0);const _=(n,t,e)=>(n.forEach(s=>{e[s]&&t.setAttribute(s,e[s]),s==="data-*"&&Object.keys(e).forEach(i=>{i.indexOf("data-")===0&&t.setAttribute(i,e[i])})}),t),H=(n,t)=>n.reduce((e,s)=>(t.hasAttribute(s)&&(e[s]=t.getAttribute(s)),s==="data-*"&&Object.keys(t.dataset).forEach(i=>{i="data-"+i.replace(/[A-Z]/g,a=>`-${a.toLowerCase()}`),e[i]=t.getAttribute(i)}),e),{}),dt=l.import("formats/link"),w=["href","rel","target","class","data-*","style"];class mt extends dt{static linkAttributesCache={};static create(t){typeof t=="string"&&(t=this.linkAttributesCache);const e=_(w,super.create(t),t);return w.forEach(s=>{s==="href"&&(t[s]=this.sanitize(t[s]),e.setAttribute(s,t[s]))}),this.linkAttributesCache=t,e}static formats(t){return H(w,t)}}l.register("formats/link",mt,!0);const k=["style","class","data-*"],pt=l.import("blots/inline");class q extends pt{static create(t){return _(k,super.create(t),t)}static formats(t){return H(k,t)}}q.blotName="aioseoInline";q.tagName="aioseo-inline";l.register("formats/aioseoInline",q,!0);const ft=l.import("formats/italic");class gt extends ft{static create(t){return _(k,super.create(t),t)}static formats(t){return H(k,t)}}l.register("formats/italic",gt,!0);class Ct{constructor(t,e){this.quill=t,this.options=e,this.preserveWhitespace=e.preserveWhitespace||!1,t.clipboard.addMatcher(Node.TEXT_NODE,this.clipboardHandler.bind(this)),t.container.style.whiteSpace="pre-line"}clipboardHandler(t,e){if(t.data.match(/^\t/)&&this.preserveWhitespace){const s=l.import("delta");return new s().insert(t.data)}return e}}l.register("modules/preserveWhiteSpace",Ct);const bt=n=>{const{invalidClosingTags:t,invalidOpeningTags:e,tagNamePattern:s}=U(n);let i=n;return t.forEach(a=>{i=`<${a.match(s)[1]}>`+i}),e.forEach(a=>{const o=a.match(s)[1];i=i+`</${o}>`}),i},Tt=(n,t)=>{const{invalidClosingTags:e,invalidOpeningTags:s,tagNamePattern:i}=U(n);return e.forEach(a=>{const o=a.match(i)[1],r=new RegExp(`^<${o}>`);t=t.replace(r,"")}),s.forEach(a=>{const o=a.match(i)[1],r=new RegExp(`<\\/${o}>$`);t=t.replace(r,"")}),t},U=n=>{const t=new RegExp(/(<[^<>]*>)/),e=new RegExp(/<\s?\/[^<>]*>/),s=new RegExp(/<\s?\/?([^<\s>]*).*?>/,"s"),i=n.split(t),a=[];i.forEach(u=>{u.match(t)&&a.push(u)});const o=[];a.forEach((u,d)=>{if(!u)return;if(u.match(e)){o.push(u),a[d]="";return}const f=u.match(s)[1];let g=!1;a.forEach((L,x)=>{if(d===x||!L||g||!L.match(e))return;const P=L.match(s)[1];if(f===P){a[d]="",a[x]="",g=!0;return}o.push(u),a[d]=""})});const r=[],h=[];return o.forEach(u=>{if(u.match(t)){if(u.match(e)){h.push(u);return}r.push(u)}}),{invalidClosingTags:h,invalidOpeningTags:r,tagNamePattern:s}},Lt={},xt={viewBox:"0 0 10 11",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"aioseo-plus"};function Et(n,t){return C(),b("svg",xt,[...t[0]||(t[0]=[p("path",{d:"M6 0.00115967H4V4.00116H0V6.00116H4V10.0012H6V6.00116H10V4.00116H6V0.00115967Z",fill:"currentColor"},null,-1)])])}const vt=R(Lt,[["render",Et]]),$="all-in-one-seo-pack",c=[],Nt={emits:["counter","selection-change","updateEditor","focus","blur","update:modelValue","paste"],setup(){return{links:j,postEditorStore:Z(),tagsStore:z()}},components:{BaseInput:K,SvgCaret:J,SvgPlus:vt,SvgTrash:G},props:{modelValue:{type:String,default:""},minimumLineNumbers:{type:Number,default(){return 5}},single:Boolean,lineNumbers:Boolean,allowTags:Boolean,disabled:Boolean,tagsContext:String,forceUpdates:Boolean,monospace:Boolean,defaultMenuOrientation:String,description:Boolean,showToolbar:Boolean,preserveWhitespace:Boolean,autoLink:{type:[Object,Boolean],default(){return!1}}},data(){return{tags:A,localTags:[],quill:null,html:"",insertExact:!1,cachedPhrase:"",strings:{searchPlaceholder:S("Search for an item...",$),enterCustomFieldName:S("Enter a custom field/taxonomy name...",$),learnMoreSmartTags:S("Learn more about Smart Tags",$),removeSmartTag:S("Remove Smart Tag",$)}}},watch:{disabled(){this.disabled?c[this.$.uid].disable():c[this.$.uid].enable()},modelValue(){this.forceUpdates&&this.startup(!0)},"tagsStore.liveTags":{deep:!0,handler(){this.localTags=this.getTags();const n=c[this.$.uid].getModule("counter");n&&(n.options.tags=this.localTags,this.$emit("counter",n.calculate()))}},tags:{deep:!0,handler(){const n=this.getTags();JSON.stringify(this.localTags)!==JSON.stringify(n)&&(this.localTags=n,this.startup(!0))}}},methods:{emitPasteEvent(n){this.$emit("paste",n)},getTags(){return(this.tagsContext?[...A.context(this.tagsContext)]:[...this.tagsStore.tags].filter(t=>!t.deprecated)).map((t,e)=>{const s=this.postEditorStore.currentPost&&this.tagsStore.liveTags[t.id]||t.value;return{...t,valueText:s,value:this.$refs["select-template"]?.[e]?.innerHTML||"",menuHtml:this.$refs["menu-template"]?.[e]?.innerHTML||""}})},update(){if(this.allowTags){const i=c[this.$.uid].getModule("counter");this.$emit("counter",i.calculate())}let n=c[this.$.uid].getText()?c[this.$.uid].root.innerHTML:"";const t=document.createRange().createContextualFragment(n),e=document.createRange().createContextualFragment("");t.childNodes.forEach(i=>{if(i.tagName!=="P")return;i.childNodes.forEach(o=>{if(o.nodeType===3){e.appendChild(o.cloneNode(!0));return}if(o.tagName==="SPAN"&&this.allowTags){const r=o.querySelector(".aioseo-tag");if(r){const h=r.querySelector(".tag-name");if(h){const u=this.localTags.find(f=>f.name===h.textContent);if(u.custom){const f=r.querySelector(".tag-custom");if(f){const g=document.createTextNode(`#${u.id}-${f.innerHTML.replace("&nbsp;-&nbsp;","")}`);e.appendChild(g);return}}const d=document.createTextNode(`#${u.id}`);e.appendChild(d)}}}});const a=document.createElement("br");e.appendChild(a)}),e.normalize();const s=document.createElement("div");s.appendChild(e.cloneNode(!0)),n=s.innerHTML.replace(/<br\s*[/]?>/gi,this.single?"":`
`).trim(),n=n.replace(/&nbsp;/gi," ").trim(),this.$emit("update:modelValue",n)},insertToCursor(n){c[this.$.uid].focus(),c[this.$.uid].insertText(c[this.$.uid].getSelection().index,n,l.sources.USER),c[this.$.uid].setSelection(c[this.$.uid].getSelection().index+n.length,l.sources.USER)},insertTag(n){const t=c[this.$.uid].getModule("mention");t.removeOrphanedMentionChar();const e=t.getTextBeforeCursor();this.insertExact=!0;const s=n?this.localTags.find(o=>o.id===n):null;let i=s?`#${s.id}`:e.charAt(e.length-1)==="#"?"":"#";const a=c[this.$.uid].getContents(0,t.cursorPos);a.ops.length&&(typeof a.ops.pop().insert!="string"||!e.match(/\s$/))&&(i=" "+i),c[this.$.uid].focus(),n&&t.removeOrphanedMentionChar(),c[this.$.uid].insertText(c[this.$.uid].getSelection().index,i,l.sources.USER),c[this.$.uid].setSelection(c[this.$.uid].getSelection().index+i.length,l.sources.USER),this.insertExact=!1,n?t.hideMentionList():setTimeout(()=>{t.mentionCharPos=c[this.$.uid].getSelection().index-1,t.silentInsert=!0,t.showMentionList()},0)},maybeCloseMenu(n){const t=n.target;if(t.classList.contains("aioseo-tag")||t.closest(".aioseo-tag")||t.closest(".add-tags"))return;if(t.classList.contains("ql-mention-list-container")||t.closest(".ql-mention-list-container")){const s=t.classList.contains("prepend-icon")?t:t.closest(".prepend-icon");s&&s.nextSibling.focus();return}const e=c[this.$.uid].getModule("mention");e?.isOpen&&(e.hideMentionList(),e.removeOrphanedMentionChar())},startup(n=!1){if(this.allowTags&&!this.$refs["tag-search"])return;c[this.$.uid]=this.startQuill(),n&&c[this.$.uid].setText("");let t=this.modelValue;t&&t.length&&t.match(/#[^\s]*$/)&&(t=t.trim()+"&nbsp;"),t=t&&(this.single?t.replace(`
`," "):"<p>"+t.split(`
`).map(i=>i===""?"<br>":i).join("</p><p>")+"</p>");const e=c[this.$.uid].clipboard.convert({html:t,text:""});c[this.$.uid].setContents(e);const s=c[this.$.uid].getModule("mention");if(s?.isOpen?(s.hideMentionList(),s.removeOrphanedMentionChar()):s&&s.removeOrphanedMentionChar(!0),this.allowTags){const i=c[this.$.uid].getModule("counter");this.$emit("counter",i.calculate())}this.removeTrailingNewLine(),this.$nextTick(()=>{c[this.$.uid].on("text-change",()=>this.update()),c[this.$.uid].on("selection-change",(i,a,o)=>{o==="api"&&this.update(),i?this.$emit("focus",c[this.$.uid]):this.$emit("blur",c[this.$.uid]),this.$emit("selection-change",{range:i,oldRange:a,source:o})}),document.addEventListener("click",this.maybeCloseMenu),this.disabled&&c[this.$.uid].disable(),n||c[this.$.uid].history.clear()})},startQuill(){return new l(this.$refs.quill,{modules:{toolbar:this.showToolbar?["bold","italic","underline","autoLink"]:[],lineNumbers:this.lineNumbers?{container:this.$refs["line-numbers"],defaultLength:this.minimumLineNumbers}:null,mention:this.allowTags?{defaultMenuOrientation:this.defaultMenuOrientation||"bottom",dataAttributes:["id","value","denotationChar","link","target","custom","customValue"],allowedChars:/^[A-Za-z\s_]*$/,mentionDenotationChars:["#"],spaceAfterInsert:!0,mentionPrependClass:"aioseo-tag-search",mentionPrependClassCustom:"aioseo-tag-custom",prependMentionList:this.$refs["tag-search"].innerHTML,customFieldInput:this.$refs["tag-custom"].innerHTML,documentationDiv:this.$refs["documentation-div"].innerHTML,listItemClassNoMatch:"aioseo-tag-no-match",renderItemNoMatch(){return"No matches found"},renderItem(n){return`${n.menuHtml}`},source:(n,t,e,s=!1,i="")=>{const a=[...this.localTags];if(a[0].custom&&(a[0].customValue=i),n.length===0)return t(a,n,s,this.insertExact);const o=[];for(let r=0;r<a.length;r++)(~a[r].name.toLowerCase().indexOf(n.toLowerCase())||~a[r].id.toLowerCase().indexOf(n.toLowerCase()))&&o.push(a[r]);return t(o,n,s,this.insertExact)}}:null,counter:this.allowTags?{tags:this.localTags}:null,clipboard:{newLines:!this.single},autoLink:{enabled:!!this.autoLink,...this.autoLink},keyboard:{bindings:{enter:{key:13,handler:()=>!this.single}}},preserveWhiteSpace:this.preserveWhitespace},theme:"snow",formats:this.showToolbar?["bold","underline","italic","link","list","aioseoInline"]:["mention"]})},setPhrase(n){this.cachedPhrase=n,n=bt(n),n=n.replace(/<span([^>]*)>/g,"<aioseo-inline$1>").replace(/<\/span>/g,"</aioseo-inline>");const t=c[this.$.uid].clipboard.convert({html:n,text:""});c[this.$.uid].setContents(t)},getPhrase(){return c[this.$.uid].getText()},getPhraseWithFormats(){return c[this.$.uid].getContents()},getPhraseHtml(){let n=c[this.$.uid].root.childNodes[0].innerHTML;return n=n.replace(/<aioseo-inline([^>]*)>/g,"<span$1>").replace(/<\/aioseo-inline>/g,"</span>"),n=Tt(this.cachedPhrase,n),n},removeTrailingNewLine(){const n=document.querySelector(".aioseo-editor-description .ql-editor");this.description&&n&&(n.innerHTML=n.innerHTML.replace(/<p><br><\/p>$/i,""))}},mounted(){this.localTags=this.getTags(),this.startup(!0),this.tagsContext&&window.aioseoBus.$on("updateEditor"+this.tagsContext,n=>{n!==this.$.uid&&this.startup(!0)})},beforeUnmount(){document.removeEventListener("click",this.maybeCloseMenu)},unmounted(){this.tagsContext&&window.aioseoBus.$emit("updateEditor"+this.tagsContext,this.$.uid)}},St={class:"aioseo-editor"},It={key:0,ref:"line-numbers",class:"aioseo-line-numbers"},yt={key:1,class:"aioseo-append-icon"},Mt={key:2,class:"aioseo-append-button"},$t={class:"aioseo-tag"},kt={class:"tag-name"},Pt={key:0,class:"tag-custom"},wt={class:"tag-toggle"},_t={class:"aioseo-tag-item"},Ht={class:"aioseo-tag-title"},qt={class:"aioseo-tag-description"},At={ref:"tag-search"},Bt={ref:"tag-custom"},Ot=["innerHTML"];function Vt(n,t,e,s,i,a){const o=I("svg-caret"),r=I("svg-plus"),h=I("base-input"),u=I("svg-trash");return C(),b("div",St,[p("div",{class:X([{"aioseo-editor-line-numbers":e.lineNumbers},{"aioseo-editor-single":e.single},{"aioseo-editor-monospace":e.monospace},{"aioseo-editor-description":e.description}]),ref:"quill",onPaste:t[0]||(t[0]=(...d)=>a.emitPasteEvent&&a.emitPasteEvent(...d))},null,34),e.lineNumbers?(C(),b("div",It,null,512)):y("",!0),n.$slots["append-icon"]?(C(),b("div",yt,[O(n.$slots,"append-icon")])):y("",!0),n.$slots["append-button"]?(C(),b("div",Mt,[O(n.$slots,"append-button")])):y("",!0),(C(!0),b(V,null,Y(i.tags.context(e.tagsContext),(d,f)=>(C(),b(V,{key:f},[E(p("div",{ref_for:!0,ref:"select-template"},[p("span",$t,[p("span",kt,M(d.name),1),d.custom&&d.customValue?(C(),b("span",Pt," - "+M(d.customValue),1)):y("",!0),p("span",wt,[N(o)])])],512),[[v,!1]]),E(p("div",{ref_for:!0,ref:"menu-template"},[p("div",_t,[p("div",null,[N(r)]),p("div",null,[p("div",Ht,M(d.name),1),p("div",qt,M(d.description),1)])])],512),[[v,!1]])],64))),128)),E(p("div",At,[N(h,{size:"medium",placeholder:i.strings.searchPlaceholder,prependIcon:"search"},null,8,["placeholder"]),N(u)],512),[[v,!1]]),E(p("div",Bt,[N(h,{size:"small",placeholder:i.strings.enterCustomFieldName},null,8,["placeholder"])],512),[[v,!1]]),E(p("div",{ref:"documentation-div",innerHTML:s.links.getDocLink(i.strings.learnMoreSmartTags,"smartTags",!0)},null,8,Ot),[[v,!1]])])}const Zt=R(Nt,[["render",Vt]]);export{Zt as B,vt as S};
