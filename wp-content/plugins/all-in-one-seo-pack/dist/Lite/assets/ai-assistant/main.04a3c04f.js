import{h as E,r as $e,m as V}from"../js/utils.60c76300.js";import{f as v,i as X,a0 as ge,v as $,j as d,U as Q,b as Ce,n as ne,e as ye,Y as Se,az as Te,Q as A,R as j,T as W,M as R,S as xe,r as H,u as Y,g as Ee,ap as ie,h as re}from"../js/vendor-vue-ui.d70c869f.js";import{a as Ae}from"../js/icon.6c0bd3d8.js";import{l as le}from"../js/index.01468dbf.js";import{aX as be,aB as Z,t as Me,u as Pe,d as ce,G as Le,aY as Be,ac as Re,x as Ie,ay as ue,l as de}from"../js/app-core.61d75c0b.js";import{C as Oe}from"../js/CreditCounter.f146229c.js";import{a as fe,_ as e,W as He}from"../js/vendor-other.2cdd5822.js";import{_ as J}from"../js/Button.7fa2ada4.js";import{C as pe}from"../js/Index.104764b8.js";import{_ as Fe}from"../js/_plugin-vue_export-helper.eefbdd86.js";import{_ as Ne}from"../js/Trash.effd183e.js";import"../js/vendor-datetime.430013a3.js";import"../js/vendor-lodash.f9514987.js";import"../js/Tooltip.7f0ce0d2.js";import"../js/Close.cee3494e.js";const De="aioseo/ai-assistant",ze="AIOSEO - AI Assistant",Ge="aioseo",Ue="Quickly generate content using Artificial Intelligence.",qe={html:!1,multiple:!0,reusable:!1,customClassName:!1},Ve={content:{type:"string",default:""},userPrompt:{type:"string",default:""},messages:{type:"array",default:null},isFetching:{type:"boolean",default:!1},tone:{type:"string",default:""},audience:{type:"string",default:""}},je={name:De,title:ze,category:Ge,description:Ue,supports:qe,attributes:Ve},We={class:"aioseo-ai-assistant-sidebar"},Ye={class:"aioseo-ai-assistant-sidebar-cost"},Je={__name:"Sidebar",setup(u){const o="all-in-one-seo-pack",s=be(),a={cost:fe(e("Each AI Assistant request costs %1$s credits.",o),s.generationPrice.toLocaleString())};return(N,f)=>(v(),X("div",We,[ge($(Oe),{"tooltip-placement":"bottom","tooltip-offset":"-90px,0","parent-component-context":"sidebar"}),d("div",Ye,Q(a.cost),1)]))}},Ke={},Qe={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",class:"aioseo-renew"};function Xe(u,o){return v(),X("svg",Qe,[...o[0]||(o[0]=[d("path",{d:"M3.39984 10.7C3.15539 10.2777 2.97206 9.8444 2.84984 9.39996C2.72762 8.95551 2.6665 8.49996 2.6665 8.03329C2.6665 6.5444 3.18317 5.27774 4.2165 4.23329C5.24984 3.18885 6.51095 2.66663 7.99984 2.66663H8.1165L7.04984 1.59996L7.98317 0.666626L10.6498 3.33329L7.98317 5.99996L7.04984 5.06663L8.1165 3.99996H7.99984C6.88873 3.99996 5.94428 4.39163 5.1665 5.17496C4.38873 5.95829 3.99984 6.91107 3.99984 8.03329C3.99984 8.32218 4.03317 8.60552 4.09984 8.88329C4.1665 9.16107 4.2665 9.43329 4.39984 9.69996L3.39984 10.7ZM8.0165 15.3333L5.34984 12.6666L8.0165 9.99996L8.94984 10.9333L7.88317 12H7.99984C9.11095 12 10.0554 11.6083 10.8332 10.825C11.6109 10.0416 11.9998 9.08885 11.9998 7.96663C11.9998 7.67774 11.9665 7.3944 11.8998 7.11663C11.8332 6.83885 11.7332 6.56663 11.5998 6.29996L12.5998 5.29996C12.8443 5.72218 13.0276 6.15552 13.1498 6.59996C13.2721 7.0444 13.3332 7.49996 13.3332 7.96663C13.3332 9.45551 12.8165 10.7222 11.7832 11.7666C10.7498 12.8111 9.48873 13.3333 7.99984 13.3333H7.88317L8.94984 14.4L8.0165 15.3333Z",fill:"currentColor"},null,-1)])])}const Ze=Fe(Ke,[["render",Xe]]),et={class:"aioseo-ai-assistant-block"},tt={class:"aioseo-ai-assistant-block__head"},ot=["innerHTML"],nt={class:"aioseo-ai-assistant-block__body"},at={class:"aioseo-ai-assistant-block__input-container"},st={class:"aioseo-ai-assistant-block__input-row"},it={class:"aioseo-ai-assistant-block__input-col aioseo-ai-assistant-block__input-col--grow"},rt=["placeholder","disabled","maxlength"],lt={class:"aioseo-ai-assistant-block__input-col"},ct={class:"aioseo-ai-assistant-block__controls"},ut={key:1},dt={class:"aioseo-ai-assistant-block__input-row aioseo-ai-assistant-block__input-row--gray"},pt={class:"aioseo-ai-assistant-block__input-col aioseo-ai-assistant-block__input-col--disclaimer"},mt=["innerHTML"],ht={class:"aioseo-ai-assistant-block__error-container"},gt={__name:"Block",setup(u){const o="all-in-one-seo-pack",{toneOptions:s,audienceOptions:a,hasEnoughCredits:N}=Z(),f=be(),D=Me(),z=Pe(),S=H(null),k=H({}),_=H(null),T=H(""),L=H({api:null});let G=null,B=null;const i=Ee(),b={aiTextGenerator:e("AI Text Generator",o),insert:e("Insert",o),placeholder:e("Write a blog about... Generate a table for...",o),requestUnsuccessful:e("The request was unsuccessful. Status code:",o),generate:e("Generate",o),stop:e("Stop",o),delete:e("Delete",o),regenerate:e("Regenerate",o),noPermission:e("You do not have permission to use the AI Assistant.",o),disclaimer:fe(e("AI-generated content could be inaccurate or biased. %1$s",o),ce.getDocLink(Le.learnMore,"aiDisclaimer",!0)),userPromptMaxlength:e("You have reached the maximum number of allowed characters.",o)},x=Y(()=>_.value?.closest("[data-block]").dataset.block),h=Y(()=>{const t=!!i.root.data.userPrompt?.trim().length,n=!!i.root.data.messages?.length&&i.root.data.messages.find(we=>we.role==="assistant"),l=!!i.root.data.isFetching,O=!!T.value.length;return{submit:{disabled:!t||!f.hasPermission||!N(f.generationPrice),show:!0,loading:l,text:n?Ze:b.generate,title:n?b.regenerate:"",type:n?"gray":"blue"},insert:{show:O&&!l},stop:{show:l},delete:{show:n&&!l}}}),U=Y(()=>f.hasPermission?L.value.api?L.value.api:null:b.noPermission),q=Y(()=>i.root.data.userPrompt.length>=f.options.input.userPrompt.maxlength?b.userPromptMaxlength:null),ee=()=>{let t=window.wp.blocks.pasteHandler({HTML:T.value,plainText:i.root.data.content,mode:"AUTO"});typeof t=="string"&&(t=window.wp.blocks.createBlock("core/paragraph",{content:t}));const{dispatch:n}=window.wp.data;n("core/block-editor").replaceBlock(x.value,t)},r=()=>{oe(),ne(()=>{ve()})},g=()=>{k.value.abort()},w=()=>{const{dispatch:t}=window.wp.data;t("core/block-editor").removeBlock(x.value)},ae=()=>{const t=_.value;t.style.height="auto",t.style.height=t.scrollHeight+"px"},I=async()=>{await f.initMarkdownConverter(),T.value=f.markdownConverter.render(i.root.data.content),ae()},se=t=>{const n=i.root.data.messages||[];i.root.data.messages=[...n,t]},te=()=>window.wp.data.select("core/block-editor").getBlock(x.value),_e=t=>{if(!t)return!1;const n=t.getBoundingClientRect(),l=window.innerHeight||document.documentElement.clientHeight;return 0<=n.top&&n.top<=l},ve=()=>{S.value&&(_e(S.value)||S.value.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}))},ke=()=>{let t="";try{document.querySelectorAll(".aioseo-ai-assistant-block").forEach(n=>{n.style.visibility="hidden"}),t=Re(!0),t=t.replace(new RegExp(`<!-- wp:${te().name}.*?/-->`,"gs"),""),t&&1e4<t.length&&(t=t.substring(0,1e4))}catch(n){console.warn("Could not retrieve post content for context:",n),t=""}finally{document.querySelectorAll(".aioseo-ai-assistant-block").forEach(n=>{n.style.visibility="visible"})}return t.trim()},oe=(t={})=>{k.value=new AbortController,L.value.api=null,i.root.data.isFetching=!0,i.root.data.content="",I();const n={role:"user"};t?.translate?n.translate=t.translate:t?.improve?n.improve=t.improve:n.content=i.root.data.userPrompt,se(n),He(ce.restUrl("ai/assistant"),{headers:{"Content-Type":"application/json","X-WP-Nonce":window.aioseo.nonce},method:"POST",body:JSON.stringify({messages:i.root.data.messages,tone:s.find(l=>l.value===te().attributes.tone).label,audience:a.find(l=>l.value===te().attributes.audience).label,postContent:ke(),postTitle:(Be()||"").trim(),focusKeyword:(z.currentPost?.keyphrases?.focus?.keyphrase||"").trim()}),cache:"no-store",openWhenHidden:!0,onclose(){I()},onerror(l){throw l},onmessage(l){const O=JSON.parse(l.data);if(O?.error)throw new Error(`${O.error}`);i.root.data.content+=O?.content??"",I()},onopen(l){if(!l.ok)throw new Error(`${b.requestUnsuccessful.trim()} ${l.status}`)},signal:k.value.signal}).catch(l=>{console.error(l),L.value.api=l.message}).then(()=>{if(!i.root.data.content.trim().length){i.root.data.messages.pop();return}se({role:"assistant",content:i.root.data.content})}).finally(async()=>{await D.getCredits(!0),i.root.data.isFetching=!1,await ne(),I()})};return Ce(()=>{I(),G=t=>{!t||t.clientId!==x.value||!t.translate||oe({translate:t.translate})},B=t=>{!t||t.clientId!==x.value||!t.improve||oe({improve:t.improve})},window.aioseoBus.$on("aiAssistantTranslateChange",G),window.aioseoBus.$on("aiAssistantImproveChange",B),ne(()=>{_.value?.focus()})}),ye(()=>{window.aioseoBus.$off("aiAssistantTranslateChange",G),window.aioseoBus.$off("aiAssistantImproveChange",B)}),(t,n)=>(v(),X("div",et,[d("div",tt,[d("div",{ref_key:"contentElement",ref:S,class:"aioseo-ai-assistant-block__content",innerHTML:T.value},null,8,ot)]),d("div",nt,[d("div",at,[d("div",st,[d("div",it,[Se(d("textarea",{ref_key:"inputElement",ref:_,class:"aioseo-ai-assistant-block__input",placeholder:b.placeholder,disabled:t.$root.$data.isFetching,"onUpdate:modelValue":n[0]||(n[0]=l=>t.$root.$data.userPrompt=l),onInput:ae,rows:"1",maxlength:$(f).options.input.userPrompt.maxlength},null,40,rt),[[Te,t.$root.$data.userPrompt]])]),d("div",lt,[d("div",ct,[h.value.delete.show?(v(),A($(J),{key:0,size:"small",type:"gray",class:"aioseo-ai-assistant-block__btn",onClick:W(w,["stop","exact"]),title:b.delete},{default:j(()=>[ge($(Ne),{width:"18",height:"18"})]),_:1},8,["title"])):R("",!0),h.value.submit.show?(v(),A($(J),{key:1,disabled:h.value.submit.disabled,loading:h.value.submit.loading,type:h.value.submit.type,title:h.value.submit.title,size:"small-table",class:"aioseo-ai-assistant-block__btn",onClick:W(r,["stop","exact"])},{default:j(()=>[typeof h.value.submit.text=="object"?(v(),A(xe(h.value.submit.text),{key:0,width:"18",height:"18"})):(v(),X("span",ut,Q(h.value.submit.text),1))]),_:1},8,["disabled","loading","type","title"])):R("",!0),h.value.insert.show?(v(),A($(J),{key:2,size:"small-table",type:"blue",class:"aioseo-ai-assistant-block__btn",onClick:W(ee,["stop","exact"])},{default:j(()=>[d("span",null,Q(b.insert),1)]),_:1})):R("",!0),h.value.stop.show?(v(),A($(J),{key:3,size:"small-table",type:"gray",class:"aioseo-ai-assistant-block__btn",onClick:W(g,["stop","exact"])},{default:j(()=>[d("span",null,Q(b.stop),1)]),_:1})):R("",!0)])])]),d("div",dt,[d("div",pt,[d("span",{innerHTML:b.disclaimer},null,8,mt)])])]),d("div",ht,[U.value?(v(),A($(pe),{key:0,innerHTML:U.value,type:"red",size:"small",style:{"margin-top":"10px"}},null,8,["innerHTML"])):R("",!0),q.value?(v(),A($(pe),{key:1,innerHTML:q.value,type:"yellow",size:"small",style:{"margin-top":"10px"}},null,8,["innerHTML"])):R("",!0)])])]))}},p="all-in-one-seo-pack",m={selectLanguage:e("Select language",p),translate:e("Translate",p),arabic:e("Arabic",p),chinese:e("Chinese",p),dutch:e("Dutch",p),english:e("English",p),french:e("French",p),german:e("German",p),hindi:e("Hindi",p),italian:e("Italian",p),japanese:e("Japanese",p),korean:e("Korean",p),portuguese:e("Portuguese",p),spanish:e("Spanish",p),turkish:e("Turkish",p)},{Dropdown:bt,ToolbarButton:ft,ToolbarGroup:_t,MenuGroup:vt,MenuItem:kt}=window.wp.components,wt=[m.arabic,m.chinese,m.dutch,m.english,m.french,m.german,m.hindi,m.italian,m.japanese,m.korean,m.portuguese,m.spanish,m.turkish],$t=({attributes:u,onChange:o})=>React.createElement(_t,null,React.createElement(bt,{popoverProps:{placement:"bottom-start"},renderToggle:({isOpen:s,onToggle:a})=>React.createElement(ft,{disabled:!u.content||u.isFetching,icon:"admin-site-alt3",label:m.translate,onClick:a,"aria-expanded":s}),renderContent:({onClose:s})=>React.createElement(vt,{label:m.selectLanguage},wt.map(a=>React.createElement(kt,{onClick:()=>{o(a),s()}},a)))})),c="all-in-one-seo-pack",F={improve:e("Improve",c),contentLength:e("Content Length",c),contentStructure:e("Content Structure",c),contentType:e("Content Type",c),contentTone:e("Content Tone",c)},{Dropdown:Ct,ToolbarButton:yt,ToolbarGroup:me,MenuGroup:C,MenuItem:y}=window.wp?.components||{},K={contentLength:[{value:"summarize",label:e("Summarize",c)},{value:"makeLonger",label:e("Make longer",c)},{value:"makeShorter",label:e("Make shorter",c)}],contentStructure:[{value:"expandOnKeyPoints",label:e("Expand on key points",c)},{value:"reorganizeForClarity",label:e("Reorganize for clarity / bullet points",c)},{value:"addExamples",label:e("Add examples / case studies",c)},{value:"removeFiller",label:e("Remove filler / make concise",c)}],contentType:[{value:"rewriteAsBlog",label:e("Rewrite as blog",c)},{value:"rewriteAsListicle",label:e("Rewrite as listicle",c)},{value:"rewriteAsStory",label:e("Rewrite as story / narrative",c)},{value:"rewriteForSeo",label:e("Rewrite for SEO (keyword-focused)",c)}],contentTone:[{value:"makeMoreFormal",label:e("Make more formal",c)},{value:"makeLessFormal",label:e("Make less formal",c)},{value:"makeMoreHumorous",label:e("Make more humorous",c)},{value:"makeMoreSerious",label:e("Make more serious",c)},{value:"makeMoreProfessional",label:e("Make more professional",c)},{value:"makeMoreCasual",label:e("Make more casual",c)}]},St=({attributes:u,onChange:o})=>E`
<${me}>
	<${Ct}
		popoverProps=${{placement:"bottom-start"}}
		renderToggle=${({isOpen:s,onToggle:a})=>E`
			<${yt}
				disabled=${!u.content||u.isFetching}
				icon="admin-customizer"
				label="${F.improve}"
				onClick=${a}
				aria-expanded=${s}
			/>
		`}
		renderContent=${({onClose:s})=>E`
			<${C} label="${F.contentLength}">
				${K.contentLength.map(a=>E`
					<${y} onClick=${()=>{o(a.value),s()}}>
						${a.label}
					</${y}>
				`)}
			</${C}>

			<${C} label="${F.contentStructure}">
				${K.contentStructure.map(a=>E`
					<${y} onClick=${()=>{o(a.value),s()}}>
						${a.label}
					</${y}>
				`)}
			</${C}>

			<${C} label="${F.contentType}">
				${K.contentType.map(a=>E`
					<${y} onClick=${()=>{o(a.value),s()}}>
						${a.label}
					</${y}>
				`)}
			</${C}>

			<${C} label="${F.contentTone}">
				${K.contentTone.map(a=>E`
					<${y} onClick=${()=>{o(a.value),s()}}>
						${a.label}
					</${y}>
				`)}
			</${C}>
		`}
	/>
</${me}>`,Tt="all-in-one-seo-pack",xt={tone:e("Tone",Tt)},{SelectControl:Et}=window.wp.components,At=({value:u,onChange:o})=>{const{toneOptions:s}=Z();return React.createElement(Et,{label:xt.tone,value:u,options:s,onChange:o,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})},Mt="all-in-one-seo-pack",Pt={audience:e("Audience",Mt)},{SelectControl:Lt}=window.wp.components,Bt=({value:u,onChange:o})=>{const{audienceOptions:s}=Z();return React.createElement(Lt,{label:Pt.audience,value:u,options:s,onChange:o,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})},Rt="all-in-one-seo-pack",{name:It,title:Ot,description:Ht,category:Ft,supports:Nt,attributes:Dt}=je,P=window.wp,{useEffect:zt}=P.element,{InspectorControls:Gt}=P.blockEditor||P.editor,{BlockControls:Ut}=P.blockEditor,he=P.components.PanelBody,M=[],qt={notFanOfOptions:e("Not a fan of these options? You can set your own tone/audience directly in your prompt.",Rt)},Vt={title:Ot,description:Ht,category:Ft,supports:Nt,attributes:Dt,icon:Ae,edit:function({setAttributes:u,attributes:o,clientId:s,className:a,isSelected:N,toggleSelection:f}){const D=Ie(),{toneOptions:z,audienceOptions:S}=Z(),k=`aioseo-block-${s}`,_=`aioseo-sidebar-${s}`,T=document.getElementById(k),L=document.querySelector(".block-editor");window.wp.data.useSelect(r=>r("core/edit-post").getActiveGeneralSidebarName())==="edit-post/block"&&(typeof f!="function"||f(!0)),(N||T)&&ue({id:k,parent:L,subtree:!0,loop:!1,done:r=>{if(r.firstChild)return;V(k,M);let g=ie({name:"Blocks/AiAssistant",data:()=>o,watch:{"$data.userPrompt":{handler:function(w){u({userPrompt:w})}},"$data.isFetching":{handler:function(w){u({isFetching:w})}},"$data.content":{handler:function(w){u({content:w})}},"$data.messages":{handler:function(w){u({messages:w})}}},render:()=>re(gt)});g=le(g),de(g),g.mount(r),M.push({id:k,app:g})}});const B=M.find(r=>_===r.id),i=document.querySelector(".interface-interface-skeleton__sidebar");T&&i&&(!B||!i.contains(B.app._container))&&ue({id:_,parent:i,subtree:!0,loop:!1,done:r=>{V(_,M);let g=ie({name:"Blocks/AiAssistant/Sidebar",render:()=>re(Je)});g=le(g),de(g),g.mount(r),M.push({id:_,app:g})}}),zt(()=>()=>{V(k,M),V(_,M)},[]);const b=r=>{u({tone:r.toLowerCase()})},x=r=>{u({audience:r.toLowerCase()})},h=r=>{window.aioseoBus.$emit("aiAssistantTranslateChange",{clientId:s,translate:r})},U=r=>{window.aioseoBus.$emit("aiAssistantImproveChange",{clientId:s,improve:r})},q=z.find(r=>r.value===D.options.aiContent.tone)||z[0];o.tone||(P.data.dispatch("core/block-editor").__unstableMarkNextChangeAsNotPersistent?.(),u({tone:q.value}));const ee=S.find(r=>r.value===D.options.aiContent.audience)||S[0];return o.audience||(P.data.dispatch("core/block-editor").__unstableMarkNextChangeAsNotPersistent?.(),u({audience:ee.value})),React.createElement(React.Fragment,null,React.createElement(Ut,null,React.createElement($t,{attributes:o,onChange:h}),React.createElement(St,{attributes:o,onChange:U})),React.createElement(Gt,null,React.createElement(he,{initialOpen:!0},React.createElement(At,{value:o.tone,onChange:b}),React.createElement(Bt,{value:o.audience,onChange:x}),React.createElement("div",null,qt.notFanOfOptions)),React.createElement(he,{initialOpen:!0},React.createElement("div",{id:_,class:"aioseo-app"}))),React.createElement("div",{className:a},React.createElement("div",{id:k})))},save:function(){return null}};$e({name:It,settings:Vt});
